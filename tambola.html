<!DOCTYPE html>
<html lang="en-IN">
<meta>

<head>
    <title> Family Ticket Generator </title>
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <style>
        div {
            margin: 2px;
            
        }
    
        .outterDiv {
            float: left;
            background-color: #EEEEEE;
        }

        table {
            border: 1px solid black;
        }

        tr td:nth-child(1),
        tr td:nth-child(3),
        tr td,
        tr td:nth-child(9),
        tr td:nth-child(5),
        tr td:nth-child(7) {
            background: #ccc;
        }

        th,
        td {
            border-bottom: 1px solid #ddd;
        }
    </style>
    <script>
        $(document).ready(function () {
            var max_fields = 50; //maximum input boxes allowed
            var wrapper = $(".input_fields_wrap"); //Fields wrapper
            var add_button = $(".add_field_button"); //Add button ID

            var x = 1; //initlal text box count
            $(add_button).click(function (e) { //on add input button click
                e.preventDefault();
                if (x < max_fields) { //max input box allowed
                    x++; //text box increment

                    outer_one = document.createElement('div')
                    outer_one.setAttribute("class","outterDiv")
                    while(true){
                        try {
                            outer_one.appendChild(createTable(transform(transformTo9Column(returnRandom15Words()))));
                            break;
                        }
                        catch(err) {
                          console.log("Getting error")
                        }
                    }
                    
                    var second = document.createElement('div')
                    let input = document.createElement('input')
                    second.append(input);
                    input.setAttribute('type', 'text')
                    input.setAttribute('name', 'mytext[]')
                    outer_one.appendChild(second)

                    let href = document.createElement('a')
                    href.className = 'remove_field'
                    href.text = 'remove'
                    outer_one.appendChild(href)
                    outer_one.appendChild(document.createElement('br'))
                    // outer_one.appendChild('<div><input type="text" name="mytext[]"/><div><a href="#" class="remove_field"> Remove </a></div><br>'); //add input box
                    wrapper.append(outer_one);


                }
            });

            $(wrapper).on("click", ".remove_field", function (e) { //user click on remove text
                e.preventDefault();
                $(this).parent('div').remove();
                x--;
            })
        });

        function getRandomInt(max) {
            return Math.ceil(Math.random() * max);
        }

        function getRandomIntFloor(max) {
            return Math.floor(Math.random() * max);
        }

        function checkTambolaValue(number, original_list, columnCounterMap, timing3Map) {
            columnValue = Math.ceil(number / 10)
            sectionValue = Math.ceil(number / 30)
            columnCounterMap.has(columnValue) ? columnCounterMap.set(columnValue, columnCounterMap.get(columnValue) + 1) : columnCounterMap.set(columnValue, 1)
            timing3Map.has(sectionValue) ? timing3Map.set(sectionValue, timing3Map.get(sectionValue) + 1) : timing3Map.set(sectionValue, 1)
            original_list = original_list.filter(x => x != number)
            original_list = (columnCounterMap.get(columnValue) == 2) ? original_list.filter(x => !(Math.ceil(x / 10) == columnValue)) : original_list
            original_list = (timing3Map.get(sectionValue) == 5) ? original_list.filter(x => !(Math.ceil(x / 30) == sectionValue)) : original_list
            return original_list
        }

        function transform(input_arr) {
            // Sample input 
            //input_arr = [];   for (let index = 0; index < 3; index++) { input_arr[index] = [1,2, 3] }
            source_rows = input_arr[0].length
            source_column = input_arr.length
            transform_arr = [];
            for (let index = 0; index < source_rows; index++) {
                transform_arr[index] = []
                for (let index_inner = 0; index_inner < source_column; index_inner++) {
                    transform_arr[index][index_inner] = input_arr[index_inner][index]
                }
            }
            //console.log(transform_arr)
            return transform_arr
        }


        function transformTo9Column(arr) {

            // arr = [6, 10, 12, 27, 30, 32, 41, 46, 52, 53, 68, 69, 78, 83, 85] // Sample input for testing 
            var columnCounterMap = new Map(); // column 2 never 
            renderingBo = []
            for (let index = 0; index < 9; index++) {
                renderingBo[index] = [0, 0, 0]
            }

            // grouping them by 
            arr.forEach(x => {
                index = Math.ceil(x / 10)
                if (columnCounterMap.has(index)) {
                    columnCounterMap.get(index).push(x)
                }
                else {
                    emptyArr = []
                    emptyArr.push(x)
                    columnCounterMap.set(index, emptyArr)
                }
            })

            //console.log(arr)
            //console.log(columnCounterMap)
            let position_counter = new Map();
            for (let entry of columnCounterMap) { // the same as of recipeMap.entries()
                row_position_option = [0, 1, 2]
                for (let index = 0; index < 3; index++) {
                    if (position_counter.get(index) == 5) {
                        row_position_option = row_position_option.filter(x => x !== index)
                    }
                }
                let entry_lenght = entry[1].length
                let first = true;
                entry[1].sort(function (a, b) { return a - b }).forEach(element => {
                        random_index = getRandomIntFloor(row_position_option.length)
                        position_value = row_position_option[random_index]
                        if (position_counter.has(position_value)) {
                            position_counter.set(position_value, position_counter.get(position_value) + 1)
                        } else {
                            if (position_value == null)
                                    throw  "No proper result";
                            position_counter.set(position_value, 1)

                            
                        }
                        console.log("row_length :" + row_position_option.length)
                        console.log("randome_Value :" + random_index)
                        console.log("position_value :" + position_value)
                        row_position_option = row_position_option.filter(x => x != position_value)
                        renderingBo[entry[0] - 1][position_value] = element;
                });

            }

            console.log(position_counter)
            console.log(renderingBo)
            return renderingBo

        }

        function createTable(tableData) {
            var div = document.createElement('div');
            var table = document.createElement('table');
            var tableBody = document.createElement('tbody');

            tableData.forEach(function (rowData) {
                var row = document.createElement('tr');

                rowData.forEach(function (cellData) {
                    var cell = document.createElement('td');
                    if (cellData == 0) {
                        cellData = ""
                    }
                    cell.appendChild(document.createTextNode(cellData));
                    row.appendChild(cell);
                });

                tableBody.appendChild(row);
            });

            table.appendChild(tableBody);
            div.appendChild(table);
            // document.body.appendChild(table);
            return div
        }

        function returnRandom15Words() {
            var original_list = [];
            var solution_list = []; // solution space 
            var columnCounterMap = new Map(); // column 2 never 
            var timing3Map = new Map(); //  3 sections : 5 value 
            for (var i = 1; i < 91; i++) {
                original_list.push(i)
            }

            for (var i = 1; i < 10; i++) {
                number = getRandomInt(10) + (i - 1) * 10
                original_list = checkTambolaValue(number, original_list, columnCounterMap, timing3Map)
                solution_list.push(number)
            }
            //console.log(solution_list)
            //console.log(original_list)
            //console.log(columnCounterMap)
            //console.log(timing3Map)

            while (true) {
                number = getRandomInt(original_list.length)
                number = original_list[number]
                //console.log("New value coming " + (number))
                original_list = checkTambolaValue(number, original_list, columnCounterMap, timing3Map)
                solution_list.push(number)
                //console.log(solution_list)
                //console.log(original_list)
                //console.log(columnCounterMap)
                //console.log(timing3Map)
                if (solution_list.length == 15) {
                    return solution_list.sort(function (a, b) { return a - b })
                }
            }
        }


    </script>
</head>

<body lang="en">
    <H1> Tambola Ticket Generator </H1>

    <div class="input_fields_wrap">
        <div><button class="add_field_button">Add More Tickets</button></div>
        <br>
        <br>
    </div>

</body>

</html>